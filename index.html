<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viral Script Architect v7.0 - Daily Limit Mode</title>
    <style>
        :root { --yt-red: #ff0000; --bg: #0d0d0d; --card: #1a1a1a; --text: #f0f0f0; --accent: #00e676; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 800px; margin: auto; background: var(--card); border-radius: 15px; padding: 30px; border: 1px solid #333; }
        
        .limit-info { font-size: 12px; color: #aaa; text-align: center; margin-bottom: 10px; }
        .limit-count { color: var(--accent); font-weight: bold; }

        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        .flashing { animation: flash 1.5s infinite; color: var(--accent); font-weight: bold; }

        #progress-container { display: none; width: 100%; background: #000; border: 1px solid #444; border-radius: 20px; height: 25px; margin: 20px 0; position: relative; }
        #progress-bar { width: 0%; height: 100%; background: var(--yt-red); border-radius: 20px; transition: width 0.3s; }
        
        input, textarea, select { width: 100%; padding: 12px; background: #000; border: 1px solid #444; border-radius: 8px; color: #fff; margin-bottom: 15px; box-sizing: border-box; }
        .btn { background: var(--yt-red); color: #fff; border: none; padding: 15px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn:disabled { background: #444; cursor: not-allowed; }

        #output { background: #000; padding: 20px; border-radius: 10px; border: 1px solid #444; min-height: 200px; white-space: pre-wrap; margin-top: 20px; line-height: 1.6; }
        .error-log { color: #ffbb00; font-size: 14px; margin-top: 15px; display: none; background: #332200; padding: 15px; border-radius: 8px; border: 1px solid #ffbb00; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; margin-bottom: 5px;">Script Architect Pro</h1>
    <div class="limit-info">Daily Usage: <span id="usageCount" class="limit-count">0</span> / 5 Scripts</div>

    <label style="font-size:11px; color:#888;">GEMINI API KEY</label>
    <input type="password" id="apiKey" placeholder="Paste your API key...">

    <label style="font-size:11px; color:#888;">TOPIC</label>
    <input type="text" id="topic" placeholder="e.g. Dhurandhar Movie Analysis">

    <label style="font-size:11px; color:#888;">DETAILS</label>
    <textarea id="notes" rows="3" placeholder="Cast, Plot, Style instructions..."></textarea>

    <button id="genBtn" class="btn" onclick="generate()">GENERATE SCRIPT</button>

    <div id="loading-area" style="display:none; text-align:center; margin-top:20px;">
        <div class="flashing">ARCHITECTING YOUR VIRAL SCRIPT...</div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
    </div>

    <div id="errorLog" class="error-log"></div>
    <div id="output">Your script will appear here...</div>
</div>

<script>
    const MAX_DAILY_SCRIPTS = 5;

    // Load Usage Data on Start
    window.onload = () => {
        updateUsageUI();
        const key = localStorage.getItem('_gemini_v7_key');
        if (key) document.getElementById('apiKey').value = key;
    };

    function updateUsageUI() {
        const usage = getTodayUsage();
        document.getElementById('usageCount').innerText = usage;
        if (usage >= MAX_DAILY_SCRIPTS) {
            document.getElementById('genBtn').disabled = true;
            document.getElementById('genBtn').innerText = "LIMIT REACHED FOR TODAY";
        }
    }

    function getTodayUsage() {
        const dateKey = new Date().toISOString().split('T')[0]; // YYYY-MM-DD
        const storedData = JSON.parse(localStorage.getItem('_usage_tracker') || '{}');
        return storedData[dateKey] || 0;
    }

    function incrementUsage() {
        const dateKey = new Date().toISOString().split('T')[0];
        const storedData = JSON.parse(localStorage.getItem('_usage_tracker') || '{}');
        storedData[dateKey] = (storedData[dateKey] || 0) + 1;
        localStorage.setItem('_usage_tracker', JSON.stringify(storedData));
        updateUsageUI();
    }

    async function generate() {
        const key = document.getElementById('apiKey').value.trim();
        const topic = document.getElementById('topic').value;
        const notes = document.getElementById('notes').value;
        const output = document.getElementById('output');
        const errorLog = document.getElementById('errorLog');
        const loader = document.getElementById('loading-area');
        const bar = document.getElementById('progress-bar');

        if (getTodayUsage() >= MAX_DAILY_SCRIPTS) {
            return alert("You have reached your limit of 5 scripts for today.");
        }

        if (!key || !topic) return alert("Please fill API Key and Topic.");
        localStorage.setItem('_gemini_v7_key', key);

        loader.style.display = "block";
        errorLog.style.display = "none";
        output.innerText = "Processing...";
        
        let progress = 0;
        const interval = setInterval(() => {
            if (progress < 90) {
                progress += 2;
                bar.style.width = progress + "%";
            }
        }, 500);

        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${key}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: `Write a Hinglish YouTube script for ${topic}. Context: ${notes}` }] }] })
            });

            const data = await response.json();
            clearInterval(interval);

            if (response.status === 429) {
                errorLog.innerText = "Bhai, this is your current limit for the day. Come back tomorrow after 24 hours to generate more!";
                errorLog.style.display = "block";
                output.innerText = "Limit Reached.";
            } else if (data.candidates) {
                bar.style.width = "100%";
                setTimeout(() => {
                    loader.style.display = "none";
                    output.innerText = data.candidates[0].content.parts[0].text;
                    incrementUsage(); // Only count successful generations
                }, 500);
            } else {
                errorLog.innerText = "Error: " + JSON.stringify(data.error);
                errorLog.style.display = "block";
            }
        } catch (err) {
            clearInterval(interval);
            output.innerText = "System error occurred.";
        }
    }
</script>

</body>
</html>
